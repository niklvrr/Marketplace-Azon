# Маркетплейс Azon

**Azon** — это бэкенд-сервис для торговой площадки, реализованный на Go. Проект представляет собой RESTful API, которое позволяет пользователям регистрироваться, продавать и покупать товары. Архитектура выполнена в виде монолита с четким разделением на слои, что упрощает поддержку и дальнейшее развитие.

---

## Ключевые функции

* **Аутентификация и авторизация:** Безопасная система на основе JWT-токенов.
* **Безопасный выход:** Реализация черного списка JWT-токенов в Redis при выходе из системы.
* **Управление товарами:** Полный CRUD для создания, редактирования, поиска и получения товаров.
* **Корзина и Заказы:** Функционал для добавления товаров в корзину и оформления заказов.
* **Кэширование:** Использование Redis для кэширования часто запрашиваемых данных и ускорения ответов.
* **Админ-панель:** Набор эндпоинтов для администрирования пользователей и модерации товаров.

---

## Технологический стек

-   **Язык:** Go 1.25.0
-   **Веб-фреймворк:** Gin
-   **База данных:** PostgreSQL
-   **Кэш:** Redis
-   **Контейнеризация:** Docker, Docker Compose
-   **Миграции:** golang-migrate

---

## Требования

Для запуска и работы с проектом вам понадобятся:
* Docker и Docker Compose
* Go 1.25.0 или выше (для запуска тестов и локальной разработки)

---

## Установка и запуск

1.  **Клонируйте репозиторий:**
    ```sh
    git clone <your-repository-url>
    cd <repository-name>
    ```

2.  **Настройте переменные окружения:**
    Создайте файл `.env` в корне проекта, скопировав содержимое из `configs/config.yaml` и заменив значения на свои. Обязательные переменные:
    ```env
    DB_URL=postgres://user:password@postgres-db:5432/dbname?sslmode=disable
    JWT_SECRET_KEY=your_super_secret_key
    REDIS_ADDR=redis-cache:6379
    ```

3.  **Примените миграции базы данных:**
    Убедитесь, что `golang-migrate` установлен. Выполните команду:
    ```sh
    migrate -path ./migrations -database "${DB_URL}" up
    ```
    *(Замените `${DB_URL}` на ваше значение из `.env`)*

4.  **Запустите проект с помощью Docker Compose:**
    ```sh
    docker-compose up --build
    ```
    Сервис будет доступен по адресу `http://localhost:8080`.

## Тестирование

Проект покрыт unit- и интеграционными тестами (~70%). Для запуска всех тестов выполните команду:
```sh
go test ./...
```

## Примеры использования API

**Регистрация нового пользователя:**

```sh
curl -X POST http://localhost:8080/api/v1/users/signup \
-H "Content-Type: application/json" \
-d '{
    "name": "John Doe",
    "email": "john.doe@example.com",
    "password": "securepassword123"
}'
```

# Документация по проекту "Маркетплейс Azon"

## 1. Архитектура

Проект реализован в виде **монолитного приложения** с четкой **слоистой архитектурой (Layered Architecture)**. Такое разделение позволяет изолировать бизнес-логику от деталей реализации (например, от базы данных или веб-фреймворка) и упрощает тестирование и поддержку.

**Жизненный цикл запроса:**
1.  Запрос поступает в **`Router`** (`internal/api/router`), который определяет, какой обработчик должен его выполнить.
2.  При необходимости запрос проходит через **`Middleware`** (`internal/api/middleware`) для проверки JWT-токена.
3.  **`Handler`** (`internal/handler`) принимает запрос, валидирует его и вызывает соответствующий метод сервиса. Этот слой отвечает за работу с HTTP.
4.  **`Service`** (`internal/service`) содержит основную бизнес-логику, свободную от деталей HTTP. Он координирует работу с репозиториями.
5.  **`Repository`** (`internal/repository`) отвечает за взаимодействие с базами данных (PostgreSQL, Redis). Он скрывает детали выполнения SQL-запросов или команд Redis.
6.  **`Model`** (`internal/model`) определяет структуры данных, используемые во всем приложении.

## 2. Описание пакетов и слоёв

* `cmd/main.go`: Точка входа в приложение. Здесь происходит инициализация конфигурации, зависимостей и запуск сервера.
* `internal/api`: Пакет, отвечающий за все, что связано с API.
    * `middleware`: Промежуточное ПО (например, для проверки JWT).
    * `router`: Определение и группировка всех HTTP-маршрутов.
* `internal/app`: Содержит логику "сборки" приложения, инкапсулируя запуск и остановку сервера.
* `internal/config`: Логика загрузки конфигурации из `.yaml` и переменных окружения.
* `internal/db`, `internal/rdb`: Пакеты для установки соединения с PostgreSQL и Redis соответственно.
* `internal/handler`: Слой обработки HTTP-запросов. Преобразует HTTP-запросы в вызовы методов сервиса.
* `internal/service`: Слой бизнес-логики.
* `internal/repository`: Слой доступа к данным. Реализует интерфейсы для работы с хранилищами.
* `internal/model`: Структуры данных (запросы, ответы, модели БД).
* `migrations`: SQL-файлы для миграций базы данных (`golang-migrate`).
* `pkg`: Вспомогательные пакеты, которые могут быть переиспользованы (JWT, логгер, утилиты).

## 3. Работа с конфигурацией

Конфигурация проекта гибридная:
* **`configs/config.yaml`**: хранит значения по умолчанию, которые не являются секретными.
* **`.env`**: используется для переопределения значений из `yaml` и для хранения секретов (ключ JWT, URL базы данных). Переменные из этого файла имеют приоритет.

Для запуска приложения необходимо определить следующие переменные окружения в файле `.env`:

| Переменная     | Описание                                  | Пример                                                           |
|----------------|-------------------------------------------|------------------------------------------------------------------|
| `DB_URL`       | Строка подключения к PostgreSQL           | `postgres://user:pass@postgres-db:5432/dbname?sslmode=disable` |
| `JWT_SECRET_KEY` | Секретный ключ для подписи JWT-токенов    | `your_super_secret_key`                                          |
| `REDIS_ADDR`   | Адрес сервера Redis                       | `redis-cache:6379`                                               |

## 4. Описание API

### Аутентификация
Все защищенные эндпоинты требуют наличия заголовка `Authorization: Bearer <your_jwt_token>`.

### Пользователи (`/api/v1/users`)
| Метод | Путь       | Описание                    | Аутентификация | Тело запроса (JSON)                                |
|-------|------------|-----------------------------|----------------|----------------------------------------------------|
| POST  | `/signup`  | Регистрация нового пользователя | Нет            | `{"name": "string", "email": "string", "password": "string"}` |
| POST  | `/login`   | Вход в систему и получение токена | Нет            | `{"email": "string", "password": "string"}`      |
| POST  | `/logout`  | Выход из системы            | Да             | -                                                  |

### Товары (`/api/v1/products`)
| Метод | Путь       | Описание                    | Аутентификация | Тело запроса (JSON)                                |
|-------|------------|-----------------------------|----------------|----------------------------------------------------|
| POST  | `/`        | Создание нового товара      | Да (Продавец)  | `{"name": "string", "description": "string", "price": float, "category_id": int}` |
| GET   | `/:id`     | Получение товара по ID      | Нет            | -                                                  |
| GET   | `/`        | Получение списка товаров    | Нет            | -                                                  |

## 5. Тестирование

Проект содержит unit- и интеграционные тесты. Unit-тесты изолируют логику с помощью моков (библиотека `testify/mock`). Интеграционные тесты проверяют взаимодействие с реальной (тестовой) базой данных.

**Запуск всех тестов:**
```sh
go test ./...
````

**Запуск тестов с отображением покрытия:**

```sh
go test ./... -cover
```